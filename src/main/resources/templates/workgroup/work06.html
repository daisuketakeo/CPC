<div th:fragment="paramset(wgrp)" th:remove="tag">
<script th:inline="javascript">
$(function() {
	
	var wgrp = /*[[${wgrp}]]*/ '';
	var batch_id = $('#BATCH_ID').val();
	var process_id = $('#PROCESS_ID').val();
	
	// 作業グループ名セット
	getWorkGroupName(wgrp, wgrp, "work_group_name");
	
	// 要素名
	var okbtn = '#okbtn'+wgrp;
	var printbtn = '#printbtn'+wgrp;
	var kitlabel = '#kitlabel'+wgrp;
	var tdcheck = '#tdcheck'+wgrp;
	var tdcoa = '#tdcoa'+wgrp;
	var td = '#td'+wgrp;
	var work_id = '#work_id'+wgrp;
	var eximg = '#eximg'+wgrp;
	
	// 逸脱アイコン非表示
	$(eximg).hide();
	
	// 作業手順取得
	var args = "?WORK_GROUP="+wgrp;
	$.ajax({
	    type: "GET", 
	    url: '/rest/workmst/select'+args,
	}).done(function(data, dataType) {
	    var usage_arr = JSON.parse(data);
	    //データをテーブル形式にする
	    $.each(usage_arr.list,function(i,WORK_MASTER){
	    	
 		    $(td+WORK_MASTER.work_ID).text(WORK_MASTER.work);
 		    
 			// ステータスチェック
 			var args = 
 				"?WORK_GROUP="+wgrp+
 				"&WORK_ID="+WORK_MASTER.work_ID+
 				"&ID="+batch_id;
 			$.ajax({
 			type: "GET", 
 			url: '/ajax/check_status'+args,
 			}).done(function(data, dataType) {
 				if(data==false){
 					setDisabled(okbtn+WORK_MASTER.work_ID,true);
 				}else{
 					open_work(wgrp, true);	// 作業手順表示
 					setDisabled(okbtn+WORK_MASTER.work_ID,false);
 				}
 			}).fail(function(XMLHttpRequest, textStatus, errorThrown) {
 				console.log('Error : ' + errorThrown + ", Reason: " + textStatus);
 			});
 			
	    });
	    
	}).fail(function(XMLHttpRequest, textStatus, errorThrown) {
	  console.log('Error : ' + errorThrown + ", Reason: " + textStatus);
	});
 	
	// 逸脱チェック
	args = 
		"?BATCH_ID="+batch_id+
		"&PROCESS_ID="+process_id+
		"&WORK_GROUP="+wgrp;
	$.ajax({
	type: "GET", 
	url: '/rest/workgroupstatus/select'+args,
	}).done(function(data, dataType) {
		var usage_arr = JSON.parse(data);
	    if(usage_arr.list.length>0){
	    	WORK_GROUP_STATUS_TABLE = usage_arr.list[0];
 		    if(WORK_GROUP_STATUS_TABLE.status==wgrp_diviation_status){
 		    	$(eximg).show();
 		    }else{
 		    	$(eximg).hide();
 		    }
 	    }
	}).fail(function(XMLHttpRequest, textStatus, errorThrown) {
		console.log('Error : ' + errorThrown + ", Reason: " + textStatus);
	});
	
	// OKボタンクリック時の処理
	$(okbtn).click(function() {
		confirm_accept(wgrp,$(work_id).val());
	})
	
	// Printボタンクリック時の処理
	$(printbtn).click(function() {
		if($(kitlabel).val()==''){
			$.ajax({
				type: "GET", 
				url: '/ajax/make_kit_label',
				}).done(function(data, dataType) {
			    	$(kitlabel).val(data);
			    	//PDF作成処理
			        var docDef = {
			          content:[
			            {qr: data}
			          ],
			        };
			        pdfMake.createPdf(docDef).download("Kitlabel.pdf");
				}).fail(function(XMLHttpRequest, textStatus, errorThrown) {
					console.log('Error : ' + errorThrown + ", Reason: " + textStatus);
				});
		}else{
			//PDF作成処理
	        var docDef = {
	          content:[
	            {qr: $(kitlabel).val()}
	          ],
	        };
	        pdfMake.createPdf(docDef).download("Kitlabel.pdf");
		}
	})

});

</script>

<!-- コンテンツ -->
<input type="hidden" th:id="'work_id'+${wgrp}" >
<table style="width:100%;">
<tr th:id="'tr_header'+${wgrp}"><td>
<input type="checkbox" th:id="'header_check'+${wgrp}" checked="checked" style="display:none;">

<!-- 作業手順ヘッダ START -->
<table th:id="'header'+${wgrp}"class="wgrpheader" th:onclick="|header_click('__${wgrp}__')|">
	<tr>
		<td class="workheader_wgrp">
			<labeL th:id="'work_group_name'+${wgrp}"></labeL>
		<td>
		<td class="workheader_allow">
			<table>
				<tr>
					<td><img th:id="'eximg'+${wgrp}" alt="" class="aicon" src="/images/exclamation_mark.png"></td>
					<td><labeL th:id="'allow'+${wgrp}">▲</labeL></td>
				</tr>
			</table>
		<td>
	</tr>
</table>
<!-- 作業手順ヘッダ END -->

<table th:id="'proc_table'+${wgrp}" class="wgrpwork">
<tr><td>

<!-- 作業手順 START -->
<table style="width:100%">
	<!-- 手順1 -->
	<tr>
		<td>
		<table style="width:100%">
			<tr style="text-align: left;"><td>
				<table class="worktable">
					<tr>
						<td colspan="2" th:id="'td'+${wgrp}+'001'"></td>
					</tr>
					<tr class="checklistreaoson">
						<td>
							<input type="text" th:id="'kitlabel'+${wgrp}" readonly>
							<input type="button" th:id="'printbtn'+${wgrp}" value="Print" 
								class="btn custombtn" style="width:100px;">
						</td>
					</tr>
				</table>
			<td></tr>
			<tr style="text-align: right;"><td>
				<!-- 処理 -->
				<input type="button" th:id="'okbtn'+${wgrp}+'001'" value="OK" 
					class="btn custombtn" style="width:100px;" disabled="disabled">
			<td></tr>
		</table>
		</td>
	</tr>
	<!-- 手順2 -->
	<tr>
		<td>
		<table style="width:100%">
			<tr style="text-align: left;"><td>
				
				<table class="worktable">
					<tr>
						<td th:id="'td'+${wgrp}+'002'"></td>
					</tr>
				</table>
			<td></tr>
			<tr style="text-align: right;"><td>
				<!-- 処理 -->
				<input type="button" th:id="'okbtn'+${wgrp}+'002'" value="OK" 
					class="btn custombtn" style="width:100px;" disabled="disabled">
			<td></tr>
		</table>
		</td>
	</tr>
	<!-- 手順3 -->
	<tr>
		<td>
		<table style="width:100%">
			<tr style="text-align: left;"><td>
				
				<table class="worktable">
					<tr>
						<td th:id="'td'+${wgrp}+'003'"></td>
					</tr>
				</table>
			<td></tr>
			<tr style="text-align: right;"><td>
				<!-- 処理 -->
				<input type="button" th:id="'okbtn'+${wgrp}+'003'" value="OK" 
					class="btn custombtn" style="width:100px;" disabled="disabled">
			<td></tr>
		</table>
		</td>
	</tr>
	<!-- 手順4 -->
	<tr>
		<td>
		<table style="width:100%">
			<tr style="text-align: left;"><td>
				
				<table class="worktable">
					<tr>
						<td th:id="'td'+${wgrp}+'004'"></td>
					</tr>
				</table>
			<td></tr>
			<tr style="text-align: right;"><td>
				<!-- 処理 -->
				<input type="button" th:id="'okbtn'+${wgrp}+'004'" value="OK" 
					class="btn custombtn" style="width:100px;" disabled="disabled">
			<td></tr>
		</table>
		</td>
	</tr>
</table>
<!-- 作業手順 END -->

</td></tr>
</table>
<td>
</tr>
</table>

